/*! ImagePreview 2015-01-07 */
!function(a){"use strict";var b=function(a,b){this.$element=a,this.width=b.width||200,this.height=b.height||200};b.DEFAULTS={max_size:1.5},b.prototype.preview=function(a){document.body.filters?this.iePreview(a):window.HTMLCanvasElement&&this.canvasPreview(a)},b.prototype.iePreview=function(b){var c=this;this.$element.select(),this.$element.blur();var d=this.$element.value,e=a('<div style="margin-bottom: 5px;"></div>').appendTo("body"),f="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d+"' , sizingMethod= 'image' )";e.css({filter:f,display:"none",width:"1px",height:"1px"});var g=setInterval(function(){var f=e.width();if(1!==f){window.clearInterval(g);var h=c.width,i=c.height,j=c.calcZoom({boxWidth:h,boxHeight:i,imgWidth:e.width(),imgHeight:e.height()}),k="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d+"' , sizingMethod= 'scale' )",l=a("<div></div>").css(j).css({filter:k,display:"block"});b(l),e.remove()}},16)},b.prototype.canvasPreview=function(b){var c=this,d=this.$element.files;a.each(d,function(d,e){var f=new Image;f.src=window.URL.createObjectURL(e),f.onload=function(){window.URL.revokeObjectURL(f.src);var d=c.width,e=c.height,g=c.calcZoom({boxWidth:d,boxHeight:e,imgWidth:f.naturalWidth,imgHeight:f.naturalHeight}),h=a(f).css(g);b(h)}})},b.prototype.calcZoom=function(a){var b=a.boxWidth,c=a.boxHeight,d=a.imgWidth,e=a.imgHeight,f={width:"0px",height:"0px",marginLeft:"0px",marginRight:"0px",marginTop:"0px",marginBottom:"0px"};return b/c>d/e?(f.height=c,f.width=d/e*c,f.marginLeft=(b-f.width)/2,f.marginRight=b-f.marginLeft-f.width):(f.width=b,f.height=e/d*b,f.marginTop=(c-f.height)/2,f.marginBottom=c-f.marginTop-f.height),f},b.prototype.selected=function(){var a=this.$element,b=this;if(a.filters(function(a){console.info(a)}),a&&1==a.files.length){this.$imgcollection.hide();var c=a.files[0].size/1048576;b.validate(c)&&(this.$error.hide(),this.preview(function(a){b.$imgcollection.html(""),b.$imgcollection.append(a)}),this.$imgcollection.show())}},b.prototype.validate=function(a){return a>b.DEFAULTS.max_size?(this.$error.html(a.toFixed(2)+">"+max_size+"M,请选择小于"+b.DEFAULTS.max_size+"的图片"),this.$error.show(),!1):!0};var c=a.fn.imagepreview;a.fn.imagepreview=function(c,d){return this.each(function(){var e=a(this),f=e.data("bs.preview"),g=a.extend({},e.data(),"object"==typeof c&&c);f||e.data("bs.preview",f=new b(this,g)),"string"==typeof c&&f[c](d),f.$imgcollection=a("<div></div>"),e.before(f.$imgcollection),f.$error=a("<code style='display:none;'></code>"),e.before(f.$error),a(document).on("change",function(a){f.selected(a)})})},a.fn.imagepreview.Constructor=b,a.fn.imagepreview.noConflict=function(){return a.fn.imagepreview=c,this},a(window).on("load",function(){a('[data-ride="filebrowser"]').each(function(){var b=a(this);a.fn.imagepreview.call(b,b.data())})})}(jQuery);